# Microsoft Uncovers macOS Vulnerability CVE-2024-44243 Allowing Rootkit Installation
## Jan 14, 2025
### [The Hacker News](https://thehackernews.com/2025/01/microsoft-uncovers-macos-vulnerability.html)
---
<br>

Microsoft는 현재 패치된 Apple macOS에서 발생했던 보안 취약점에 대해 밝혔다. 해당 취약점은 공격자가 root 권한으로 운영체제의 SIP를 우회하고, 악성 커널 드라이버를 설치하거나 서드파티 커널 확장을 로드할 수 있게 한다.

Apple에서는 해당 취약점이 구성 문제(Configuration Issue)으로 인해 발생했다고 말했으며, 이로 인해 악성 앱이 파일 시스템의 보호도니 부분을 수정할 수 있게 됐다고 밝혔다.

SIP 우회는 다음과 같은 상황을 초래한다.
-  공격자와 악성코드 제작자가 루트킷 설치에 성공할 가능성 증가
- 지속적 멀웨어 생성 가능
- TCC 프레임워크 우회
- 추가 공격 기법과 취약점 활용을 위한 공격 표면 확장

### SIP의 파일 시스템 보호 우회할 수 있는 2가지 특수권한
1. `com.apple.rootless.install` : SIP가 제공하는 파일 시스템 제한 우회 가능
2. `com.apple.rootless.install.heritable` : Storage Kit 데몬(storagekitd)의 권한. 해당 권한을 가진 프로세스 뿐만 아니라 해당 프로세스에서 생성된 모든 자식 프로세스도 동일한 권한 상속받아 SIP 제한 우회 가능

storagekitd는 디스크 포맷, 파티션 관리, 파일 시스템 번들 로드, 디스크 복구 같은 작업을 수행해야하기 때문에 SIP 보호 해제 기능이 필요했고, Apple은 해당 권한은 storagekited와 같은 시스템 데몬에만 제한적으로 부여했다. 그러나 해당 취약점은 storagekitd가 적절한 권한 없이 임의의 프로세스를 호출할 수 있는 기능을 악용하여 `/Library/Filesystems`에 새로운 파일 시스템 번들 전달하는 방식으로 악용했다. 루트 권한을 가진 공격자는 `Library/Filesystems`에 새 파일 시스템 번들 삽입 후, storagekitd를 사용해 맞춤형 바이너리를 실행해 SIP를 우회할 수 있게 된다. <br>
SIP가 우호되면 운영체제 전체가 신뢰할 수 없게 되어 공격자가 보안 솔루션을 조작해 탐지를 회피할 수 있게 된다.

<br>

### What's new for me
- TCC(Transparency, Consent and Control) : macOS에서 애플리케이션이 민감한 사용자 데이터 및 시스템 리소스에 접근하는 것을 관리 및 규제하는 보안 프레임워크 -> 사용자는 애플리케이션이 카메라, 마이크, 위치 서비스, 연락처, 사진 등 개인 정보 접근 시 명시적 동의를 요구받으며 이를 허용/거부 할 수 있음
  - 주요 기능
    - 사용자 동의 요청 : 사용자는 자신의 데이터에 대한 제어권 유지 가능
    - 권한 관리 : 사용자는 '개인 정보 및 보안' 섹션에서 각 애플리케이션이 부여받은 권한 확인 및 수정/철회 가능
    - 데이터베이스 저장 : 사용자의 권한 부여/거부 결정은 TCC 데이터베이스에 저장됨 -> 시스템은 애플리케이션의 접근 권한 지속적으로 관리 및 적용
- [SIP(System Integrity Protection)](https://support.apple.com/en-us/102149) : 운영체제의 보호된 부분(ex. `/System`, `/usr`, `/bin`. `/sbin`. `/var`)을 악성 소프트웨어가 수정하지 못하도록 방지하는 보안 프레임워크
  - super user나 sudo를 사용해도 변경할 수 없기 때문에 rootless라고도 불린다.
  - 메커니즘
    - 시스템 파일과 디렉터리의 컨텐츠 보호, 파일 시스템 권한 보호
    - 코드 인젝션으로부터 프로세스 보호, 실시간 결합 및 DTrace
    - 서명되지 않은 커널 모듈로부터 보호
  - Apple에서 서명한 프로세스나 시스템 파일 수정할 수 있는 특수 권한 가진 프로세스만 보호된 부분 수정 가능
- rootkit : 컴퓨터 시스템에 침투하여 루트 권한 획득하고, 자신의 존재 숨기면서 시스템 제어하는 악성 소프트웨어
  - 특징 
    - 은폐성
    - 지속성
    - 권한 상승
  - 유형
    - 커널 모드 루트킷 : 커널 레벨에서 동작. 가장 강력하고 탐지 어려움
    - 유저 모드 루트킷 : 일반 애플리케이션 수준에서 동작. 커널 모드에 비해 탐지 쉬움
    - 펌웨어 루트킷 : 하드웨어 펌웨어에 설치. 시스템 포맷이나 운영 체제 재설치로도 제거 어려움

#Apple #macOS #vulnerability #CVE-2024-44243 #SIP #rootkit